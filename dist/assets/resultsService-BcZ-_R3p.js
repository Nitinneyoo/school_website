import{q as a,a as s,d as e,w as t,o as r,g as c,r as n,s as d,b as o,e as u,T as l,f as i,h as p,i as y,j as m}from"./index-C4WCsToT.js";async function f(a,t,r,c,p,y){try{const m=Date.now(),f=a.name.replace(/[^a-zA-Z0-9.-]/g,"_"),w=n(d,`results/${t}/${r}/${m}_${f}`),A=o(w,a);return new Promise(n=>{A.on("state_changed",a=>{const s=a.bytesTransferred/a.totalBytes*100;null==y||y(s)},a=>{n({success:!1,error:a.message})},async()=>{try{const d=await u(A.snapshot.ref),o={class:t,subject:r,fileName:a.name,fileURL:d,fileSize:a.size,fileType:a.type,uploadedBy:c,uploadedByName:p,uploadedAt:l.now()},y=await i(s(e,"results"),o);n({success:!0,result:{id:y.id,...o,uploadedAt:new Date}})}catch(d){n({success:!1,error:d.message})}})})}catch(m){return{success:!1,error:m.message}}}async function w(n){try{const d=a(s(e,"results"),t("class","==",n),r("uploadedAt","desc"));return(await c(d)).docs.map(a=>{var s;const e=a.data();return{id:a.id,...e,uploadedAt:null==(s=e.uploadedAt)?void 0:s.toDate()}})}catch(d){return[]}}async function A(n){try{const d=a(s(e,"results"),t("uploadedBy","==",n),r("uploadedAt","desc"));return(await c(d)).docs.map(a=>{var s;const e=a.data();return{id:a.id,...e,uploadedAt:null==(s=e.uploadedAt)?void 0:s.toDate()}})}catch(d){return[]}}async function h(a,s){try{const t=n(d,s);return await p(t),await y(m(e,"results",a)),{success:!0}}catch(t){return{success:!1,error:t.message}}}async function g(){try{const t=a(s(e,"results"),r("uploadedAt","desc"));return(await c(t)).docs.map(a=>{var s;const e=a.data();return{id:a.id,...e,uploadedAt:null==(s=e.uploadedAt)?void 0:s.toDate()}})}catch(t){return[]}}export{A as a,g as b,h as d,w as g,f as u};
