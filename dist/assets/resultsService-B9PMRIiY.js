import{q as p,b as l,d as n,w as m,o as y,g as f,e as g,s as w,f as B,h as S,T as b,i as T,k as E,l as z,n as U}from"./index-BDf_TsDU.js";async function _(e,t,s,a,r,c){try{const u=Date.now(),A=e.name.replace(/[^a-zA-Z0-9.-]/g,"_"),q=`results/${t}/${s}/${u}_${A}`,R=g(w,q),h=B(R,e);return new Promise(i=>{h.on("state_changed",o=>{const d=o.bytesTransferred/o.totalBytes*100;c==null||c(d)},o=>{console.error("Upload error:",o),i({success:!1,error:o.message})},async()=>{try{const o=await S(h.snapshot.ref),d={class:t,subject:s,fileName:e.name,fileURL:o,fileSize:e.size,fileType:e.type,uploadedBy:a,uploadedByName:r,uploadedAt:b.now()},D=await T(l(n,"results"),d);i({success:!0,result:{id:D.id,...d,uploadedAt:new Date}})}catch(o){console.error("Error saving metadata:",o),i({success:!1,error:o.message})}})})}catch(u){return console.error("Upload result error:",u),{success:!1,error:u.message}}}async function k(e){try{const t=p(l(n,"results"),m("class","==",e),y("uploadedAt","desc"));return(await f(t)).docs.map(a=>{var c;const r=a.data();return{id:a.id,...r,uploadedAt:(c=r.uploadedAt)==null?void 0:c.toDate()}})}catch(t){return console.error("Error fetching results by class:",t),[]}}async function L(e){try{const t=p(l(n,"results"),m("uploadedBy","==",e),y("uploadedAt","desc"));return(await f(t)).docs.map(a=>{var c;const r=a.data();return{id:a.id,...r,uploadedAt:(c=r.uploadedAt)==null?void 0:c.toDate()}})}catch(t){return console.error("Error fetching teacher results:",t),[]}}async function N(e,t){try{const s=g(w,t);return await E(s),await z(U(n,"results",e)),{success:!0}}catch(s){return console.error("Error deleting result:",s),{success:!1,error:s.message}}}async function x(){try{const e=p(l(n,"results"),y("uploadedAt","desc"));return(await f(e)).docs.map(s=>{var r;const a=s.data();return{id:s.id,...a,uploadedAt:(r=a.uploadedAt)==null?void 0:r.toDate()}})}catch(e){return console.error("Error fetching all results:",e),[]}}export{L as a,x as b,N as d,k as g,_ as u};
